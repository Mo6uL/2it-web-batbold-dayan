const translations = {
    en: {
        hero_title_1: "Alexander",
        hero_title_2: "The Great",
        hero_subtitle: "The King of Kings",
        scroll_hint: "Scroll to Explore",
        about_title: "About Alexander",
        about_p1: "Alexander III of Macedon, commonly known as Alexander the Great, was a king of the ancient Greek kingdom of Macedon and a member of the Argead dynasty. He was born in Pella in 356 BC and succeeded his father Philip II to the throne at the age of 20.",
        about_p2: "He spent most of his ruling years on an unprecedented series of military campaigns through Asia and northeast Africa, and by the age of thirty, he had created one of the largest empires of the ancient world, stretching from Greece to northwestern India.",
        stat_battles: "Major Battles",
        stat_wins: "Wins",
        stat_losses: "Defeats",
        stat_info: "Undefeated in battle, Alexanderâ€™s military genius lay in his ability to adapt strategy to any terrain or enemy.",
        timeline_title: "Life & Conquests",
        event_1_title: "The Birth",
        event_1_desc: "Born in Pella to King Philip II and Olympias. Tutored by Aristotle.",
        event_2_title: "The King",
        event_2_desc: "Ascends to the throne after his father's assassination. Secures Greece.",
        event_3_title: "The Invasion",
        event_3_desc: "Crosses into Asia. Wins Battle of the Granicus against Persia.",
        event_4_title: "The Fall of Persia",
        event_4_desc: "Battle of Gaugamela. Babylon surrenders. Darius III flees.",
        event_5_title: "India",
        event_5_desc: "Battle of the Hydaspes. His troops mutiny, forcing a return.",
        event_6_title: "The End",
        event_6_desc: "Dies in Babylon at age 32. His empire is divided.",
        conquests_title: "Major Battles",
        footer_note: "School Project (HTML, CSS, JS)"
    },
    cs: {
        hero_title_1: "Alexandr",
        hero_title_2: "VelikÃ½",
        hero_subtitle: "KrÃ¡l KrÃ¡lÅ¯",
        scroll_hint: "Rolujte dolÅ¯",
        about_title: "O Alexandrovi",
        about_p1: "Alexandr III. MakedonskÃ½, znÃ¡mÃ½ jako Alexandr VelikÃ½, byl krÃ¡lem starovÄ›kÃ© Makedonie a Älenem dynastie ArgeovcÅ¯. Narodil se v Pelle roku 356 pÅ™. n. l. a na trÅ¯n nastoupil ve svÃ½ch 20 letech po smrti svÃ©ho otce Filipa II.",
        about_p2: "VÄ›tÅ¡inu svÃ© vlÃ¡dy strÃ¡vil na bezprecedentnÃ­m vojenskÃ©m taÅ¾enÃ­ AsiÃ­ a severovÃ½chodnÃ­ Afrikou. Do svÃ½ch tÅ™iceti let vybudoval jednu z nejvÄ›tÅ¡Ã­ch Å™Ã­Å¡Ã­ starovÄ›kÃ©ho svÄ›ta, sahajÃ­cÃ­ od Å˜ecka aÅ¾ po severozÃ¡padnÃ­ Indii.",
        stat_battles: "HlavnÃ­ bitvy",
        stat_wins: "VÃ½hry",
        stat_losses: "Prohry",
        stat_info: "NeporaÅ¾enÃ½ v boji. Alexandrova genialita spoÄÃ­vala v adaptaci strategie na jakÃ½koli terÃ©n Äi nepÅ™Ã­tele.",
        timeline_title: "Å½ivot a vÃ½boje",
        event_1_title: "NarozenÃ­",
        event_1_desc: "Narozen v Pelle. VychovÃ¡vÃ¡n Aristotelem.",
        event_2_title: "KrÃ¡l",
        event_2_desc: "NÃ¡stup na trÅ¯n po atentÃ¡tu na Filipa II.",
        event_3_title: "Invaze",
        event_3_desc: "Vstup do Asie. VÃ½hra v bitvÄ› u GranÃ­ku.",
        event_4_title: "PÃ¡d Persie",
        event_4_desc: "Bitva u GaugamÃ©l. PÃ¡d Babylonu.",
        event_5_title: "Indie",
        event_5_desc: "Bitva u Hydaspes. Vzpoura vojska a nÃ¡vrat.",
        event_6_title: "Konec",
        event_6_desc: "Smrt v Babylonu ve vÄ›ku 32 let.",
        conquests_title: "HlavnÃ­ Bitvy",
        footer_note: "Å kolnÃ­ projekt (HTML, CSS, JS)"
    },
    mn: {
        hero_title_1: "ÐÐ»ÐµÐºÑÐ°Ð½Ð´Ñ€",
        hero_title_2: "Ð˜Ñ… Ð¥Ð°Ð°Ð½",
        hero_subtitle: "Ð¥Ð°Ð°Ð´Ñ‹Ð½ Ð¥Ð°Ð°Ð½",
        scroll_hint: "Ð”Ð¾Ð¾Ñˆ Ð³Ò¯Ð¹Ð»Ð³ÑÑ…",
        about_title: "ÐÐ»ÐµÐºÑÐ°Ð½Ð´Ñ€Ñ‹Ð½ Ñ‚ÑƒÑ…Ð°Ð¹",
        about_p1: "III ÐÐ»ÐµÐºÑÐ°Ð½Ð´Ñ€ ÐœÐ°ÐºÐµÐ´Ð¾Ð½ÑÐºÐ¸Ð¹, Ð±ÑƒÑŽÑƒ Ð˜Ñ… ÐÐ»ÐµÐºÑÐ°Ð½Ð´Ñ€, ÑÑ€Ñ‚Ð½Ð¸Ð¹ ÐœÐ°ÐºÐµÐ´Ð¾Ð½Ð¸Ð¹Ð½ Ñ…Ð°Ð°Ð½, ÐÑ€Ð³ÐµÐ°Ð´Ñ‹Ð½ ÑƒÐ³ÑÐ°Ð°Ð½Ñ‹ ÑƒÐ´Ð¸Ñ€Ð´Ð°Ð³Ñ‡ Ð±Ð°Ð¹Ð². Ð¢ÑÑ€ÑÑÑ€ ÐœÐ­Ó¨ 356 Ð¾Ð½Ð´ ÐŸÐµÐ»Ð»Ð° Ñ…Ð¾Ñ‚Ð¾Ð´ Ñ‚Ó©Ñ€ÑÓ©Ð½ Ð±Ó©Ð³Ó©Ó©Ð´ ÑÑ†ÑÐ³ Ð¤Ð¸Ð»Ð¸Ð¿ II Ð½Ð°Ñ Ð±Ð°Ñ€ÑÐ½Ñ‹ Ð´Ð°Ñ€Ð°Ð° 20 Ð½Ð°ÑÑ‚Ð°Ð¹Ð´Ð°Ð° Ñ…Ð°Ð°Ð½ ÑˆÐ¸Ñ€ÑÑÐ½Ð´ ÑÑƒÑƒÐ¶ÑÑ.",
        about_p2: "Ð¢ÑÑ€ÑÑÑ€ Ñ…Ð°Ð°Ð½Ñ‡Ð»Ð°Ð»Ñ‹Ð½Ñ…Ð°Ð° Ð¸Ñ…ÑÐ½Ñ… Ñ…ÑƒÐ³Ð°Ñ†Ð°Ð°Ð³ ÐÐ·Ð¸, Ð·Ò¯Ò¯Ð½ Ñ…Ð¾Ð¹Ð´ ÐÑ„Ñ€Ð¸ÐºÑ‚ Ñ…Ð¸Ð¹ÑÑÐ½ Ñ†ÑÑ€Ð³Ð¸Ð¹Ð½ Ð°ÑÐ½ Ð´Ð°Ð¹Ð½Ð´ Ð·Ð¾Ñ€Ð¸ÑƒÐ»ÑÐ°Ð½ Ð±Ó©Ð³Ó©Ó©Ð´ 30 Ð½Ð°ÑÐ°Ð½Ð´Ð°Ð° Ð“Ñ€ÐµÐºÑÑÑ Ð±Ð°Ñ€ÑƒÑƒÐ½ Ñ…Ð¾Ð¹Ð´ Ð­Ð½ÑÑ‚Ñ…ÑÐ³ Ñ…Ò¯Ñ€Ñ‚ÑÐ» Ò¯Ñ€Ð³ÑÐ»Ð¶Ð¸Ð»ÑÑÐ½ ÑÑ€Ñ‚Ð½Ð¸Ð¹ Ð´ÑÐ»Ñ…Ð¸Ð¹Ð½ Ñ…Ð°Ð¼Ð³Ð¸Ð¹Ð½ Ñ‚Ð¾Ð¼ Ð³Ò¯Ñ€Ð½Ð¸Ð¹Ð³ Ð±Ð°Ð¹Ð³ÑƒÑƒÐ»Ð¶ Ñ‡Ð°Ð´Ð¶ÑÑ.",
        stat_battles: "Ð¢Ð¾Ð¼Ð¾Ð¾Ñ…Ð¾Ð½ Ñ‚ÑƒÐ»Ð°Ð°Ð½ÑƒÑƒÐ´",
        stat_wins: "Ð¯Ð»Ð°Ð»Ñ‚",
        stat_losses: "Ð¯Ð»Ð°Ð³Ð´Ð°Ð»",
        stat_info: "Ð¢ÑÑ€ÑÑÑ€ Ñ‚ÑƒÐ»Ð°Ð°Ð½Ð´ Ñ…ÑÐ·ÑÑ Ñ‡ ÑÐ»Ð°Ð³Ð´Ð°Ð¶ Ð±Ð°Ð¹Ð³Ð°Ð°Ð³Ò¯Ð¹ Ð±Ó©Ð³Ó©Ó©Ð´ Ñ‚Ò¯Ò¯Ð½Ð¸Ð¹ Ñ†ÑÑ€Ð³Ð¸Ð¹Ð½ ÑÑƒÑƒÑ‚ ÑƒÑ…Ð°Ð°Ð½ Ð½ÑŒ Ð°Ð»Ð¸Ð²Ð°Ð° Ð³Ð°Ð·Ð°Ñ€ Ð½ÑƒÑ‚Ð°Ð³, Ð´Ð°Ð¹ÑÐ°Ð½Ð´ Ð´Ð°ÑÐ°Ð½ Ð·Ð¾Ñ…Ð¸Ñ†Ð¾Ñ… Ñ‡Ð°Ð´Ð²Ð°Ñ€ Ð±Ð°Ð¹Ð².",
        timeline_title: "ÐÐ¼ÑŒÐ´Ñ€Ð°Ð» Ð±Ð° Ð±Ð°Ð¹Ð»Ð´Ð°Ð½ Ð´Ð°Ð³ÑƒÑƒÐ»Ð°Ð»",
        event_1_title: "Ð¢Ó©Ñ€Ó©Ð»Ñ‚",
        event_1_desc: "ÐŸÐµÐ»Ð»Ð° Ñ…Ð¾Ñ‚Ð¾Ð´ Ñ‚Ó©Ñ€ÑÓ©Ð½. ÐÑ€Ð¸ÑÑ‚Ð¾Ñ‚ÐµÐ»ÑŒ Ð±Ð°Ð³ÑˆÐ¸Ð»ÑÐ°Ð½.",
        event_2_title: "Ð¥Ð°Ð°Ð½",
        event_2_desc: "Ð­Ñ†ÑÐ³ Ð½ÑŒ Ð°Ð»Ð°Ð³Ð´ÑÐ°Ð½Ñ‹ Ð´Ð°Ñ€Ð°Ð° Ñ…Ð°Ð°Ð½ ÑˆÐ¸Ñ€ÑÑÐ½Ð´ ÑÑƒÑƒÐ².",
        event_3_title: "Ð”Ð¾Ð²Ñ‚Ð¾Ð»Ð³Ð¾Ð¾",
        event_3_desc: "ÐÐ·Ð¸ Ñ€ÑƒÑƒ Ð½ÑÐ²Ñ‚Ñ€ÑÐ². Ð“Ñ€Ð°Ð½Ð¸ÐºÐ¸Ð¹Ð½ Ñ‚ÑƒÐ»Ð°Ð°Ð½Ð´ ÐŸÐµÑ€ÑÐ¸Ð¹Ð³ ÑÐ»Ð°Ð².",
        event_4_title: "ÐŸÐµÑ€ÑÐ¸Ð¹Ð½ ÑƒÐ½Ð°Ð»Ñ‚",
        event_4_desc: "Ð“Ð°ÑƒÐ³Ð°Ð¼ÐµÐ»Ð°Ð³Ð¸Ð¹Ð½ Ñ‚ÑƒÐ»Ð°Ð°Ð½. Ð’Ð°Ð²Ð¸Ð»Ð¾Ð½ Ð±ÑƒÑƒÐ¶ Ó©Ð³Ó©Ð².",
        event_5_title: "Ð­Ð½ÑÑ‚Ñ…ÑÐ³",
        event_5_desc: "Ð“Ð¸Ð´Ð°ÑÐ¿Ð¸Ð¹Ð½ Ñ‚ÑƒÐ»Ð°Ð°Ð½. Ð¦ÑÑ€Ð³Ò¯Ò¯Ð´ Ð±Ð¾ÑÐ»Ð¾Ð³Ð¾ Ð³Ð°Ñ€Ð³Ð°Ð¶, Ð±ÑƒÑ†Ð°Ñ…Ð°Ð´ Ñ…Ò¯Ñ€ÑÐ².",
        event_6_title: "Ð¢Ó©Ð³ÑÐ³Ó©Ð»",
        event_6_desc: "32 Ð½Ð°ÑÐ°Ð½Ð´Ð°Ð° Ð’Ð°Ð²Ð¸Ð»Ð¾Ð½Ð´ Ñ‚Ð°Ð°Ð»Ð°Ð» Ñ‚Ó©Ð³ÑÓ©Ð².",
        conquests_title: "Ð¢Ð¾Ð¼Ð¾Ð¾Ñ…Ð¾Ð½ Ñ‚ÑƒÐ»Ð°Ð°Ð½ÑƒÑƒÐ´",
        footer_note: "Ð¡ÑƒÑ€Ð³ÑƒÑƒÐ»Ð¸Ð¹Ð½ Ñ‚Ó©ÑÓ©Ð» (HTML, CSS, JS)"
    }
};

const mapData = [
    {
        title: "Granicus",
        year: "334 BCE",
        opponent: "Persian Satraps",
        outcome: "Win",
        desc: "First major victory in Asia; Alexander nearly died in hand-to-hand combat.",
        img: "map_granicus.png"
    },
    {
        title: "Issus",
        year: "333 BCE",
        opponent: "King Darius III",
        outcome: "Win",
        desc: "First direct clash with the Persian King; Darius fled, leaving his family behind.",
        img: "map_issus.png"
    },
    {
        title: "Gaugamela",
        year: "331 BCE",
        opponent: "King Darius III",
        outcome: "Win",
        desc: "The 'Masterpiece'. Effectively ended the Persian Empire's power.",
        img: "map_gaugamela.png"
    },
    {
        title: "Hydaspes",
        year: "326 BCE",
        opponent: "King Porus",
        outcome: "Win",
        desc: "Fought in India against war elephants; his costliest victory.",
        img: "map_hydaspes.png"
    }
];

function setLanguage(lang) {
    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
            gsap.to(el, {
                opacity: 0, duration: 0.2, onComplete: () => {
                    el.innerText = translations[lang][key];
                    gsap.to(el, { opacity: 1, duration: 0.2 });
                }
            });
        }
    });
    localStorage.setItem('alexander_lang', lang);
}

function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('alexander_theme', theme);
    updateParticlesColor(theme);
}

const savedLang = localStorage.getItem('alexander_lang') || 'en';
const savedTheme = localStorage.getItem('alexander_theme') || 'dark';
setLanguage(savedLang);
document.documentElement.setAttribute('data-theme', savedTheme);


window.addEventListener('scroll', () => {
    const spinner = document.getElementById('spinner');
    if (spinner) {
        const rotation = window.scrollY / 5;
        spinner.style.transform = `rotate(${rotation}deg)`;
    }
});

function toggleAudio() {
    const audio = document.getElementById('bg-audio');
    const btn = document.getElementById('audio-btn');
    if (audio.paused) {
        audio.play().catch(e => alert("Please add 'speech.mp3' to the folder to play audio."));
        btn.innerText = "ðŸ”‡ Stop";
        btn.style.background = "var(--accent)";
        btn.style.color = "var(--bg-primary)";
    } else {
        audio.pause();
        btn.innerText = "ðŸ”Š Speech";
        btn.style.background = "";
        btn.style.color = "";
    }
}


gsap.registerPlugin(ScrollTrigger);

window.onload = () => {
    const tl = gsap.timeline();
    tl.to(".title-container span", { opacity: 1, y: 0, duration: 1, stagger: 0.2, ease: "power2.out" })
        .to(".title-img-wrapper", { scale: 1, opacity: 1, duration: 1, ease: "elastic.out(1, 0.5)" }, "-=0.8")
        .to(".hero-subtitle", { opacity: 1, y: 0, duration: 1 }, "-=0.5")
        .to(".scroll-indicator", { opacity: 1, duration: 1 }, "-=0.5");
};

gsap.set(".title-container span", { opacity: 0, y: 30 });
gsap.set(".title-img-wrapper", { scale: 0, opacity: 0 });

const title = document.getElementById('moveable-title');
document.addEventListener('mousemove', (e) => {
    const x = (e.clientX / window.innerWidth - 0.5) * 30;
    const y = (e.clientY / window.innerHeight - 0.5) * 30;

    gsap.to(title, {
        rotationY: x,
        rotationX: -y,
        duration: 0.5,
        ease: "power1.out"
    });
});

gsap.utils.toArray('.stat-number').forEach(stat => {
    const target = parseInt(stat.getAttribute('data-target'));
    const cont = { val: 0 };

    gsap.to(cont, {
        val: target,
        duration: 3,
        ease: "power2.out",
        scrollTrigger: {
            trigger: stat,
            start: "top 85%",
            once: true
        },
        onUpdate: () => {
            stat.innerText = Math.floor(cont.val);
        }
    });
});

if (window.innerWidth > 900) {
    const scrollContainer = document.querySelector(".scroll-container");
    gsap.to(scrollContainer, {
        x: () => -(scrollContainer.scrollWidth - window.innerWidth),
        ease: "none",
        scrollTrigger: {
            trigger: ".horizontal-scroll",
            pin: true,
            scrub: 1,
            end: () => "+=" + scrollContainer.scrollWidth
        }
    });
}


const canvasContainer = document.getElementById('canvas-container');
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });

renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
canvasContainer.appendChild(renderer.domElement);

const particlesGeometry = new THREE.BufferGeometry();
const particlesCount = 700;
const posArray = new Float32Array(particlesCount * 3);

for (let i = 0; i < particlesCount * 3; i++) {
    posArray[i] = (Math.random() - 0.5) * 15;
}

particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));

const particlesMaterial = new THREE.PointsMaterial({
    size: 0.02,
    color: 0xd4af37,
    transparent: true,
    opacity: 0.8,
});

const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
scene.add(particlesMesh);

camera.position.z = 2;

let mouseX = 0;
let mouseY = 0;

document.addEventListener('mousemove', (event) => {
    mouseX = event.clientX / window.innerWidth - 0.5;
    mouseY = event.clientY / window.innerHeight - 0.5;
});

const clock = new THREE.Clock();

function animate() {
    const elapsedTime = clock.getElapsedTime();
    particlesMesh.rotation.y = elapsedTime * 0.05;
    particlesMesh.rotation.x = mouseY * 0.5;
    particlesMesh.rotation.y += mouseX * 0.5;
    renderer.render(scene, camera);
    requestAnimationFrame(animate);
}

animate();

window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});

function updateParticlesColor(theme) {
    let color = 0xd4af37;
    if (theme === 'light') color = 0x333333;
    else if (theme === 'night') color = 0xcd5c5c;

    const target = new THREE.Color(color);
    let t = 0;
    const interval = setInterval(() => {
        t += 0.05;
        if (t > 1) t = 1;
        particlesMaterial.color.lerp(target, 0.1);
        if (t >= 1) clearInterval(interval);
    }, 30);
}

if (savedTheme) updateParticlesColor(savedTheme);


const swapImage = document.getElementById("swapImage");
const images = ["alexander2.webp", "alexander3.avif"];
let imgIndex = 0;

if (swapImage) {
    swapImage.style.cursor = "pointer";
    swapImage.addEventListener("click", () => {
        imgIndex = (imgIndex + 1) % images.length;
        gsap.to(swapImage, {
            opacity: 0, duration: 0.3, onComplete: () => {
                swapImage.src = images[imgIndex];
                gsap.to(swapImage, { opacity: 1, duration: 0.3 });
            }
        });
    });
}

const mapTitle = document.getElementById('map-title');
const mapDesc = document.getElementById('map-desc');
const mapImg = document.getElementById('map-image');
const mapDotsContainer = document.getElementById('map-dots');
let currentMap = 0;

mapData.forEach((_, idx) => {
    const dot = document.createElement('div');
    dot.classList.add('dot');
    if (idx === 0) dot.classList.add('active');
    dot.addEventListener('click', () => goToMap(idx));
    mapDotsContainer.appendChild(dot);
});

function updateMapDisplay() {
    const data = mapData[currentMap];

    gsap.to([mapTitle, mapDesc], {
        opacity: 0, y: -10, duration: 0.2, onComplete: () => {
            mapTitle.innerHTML = `${data.title} <span style="font-size:0.6em; opacity:0.8">${data.year}</span>`;
            mapDesc.innerHTML = `
            <strong>Opponent:</strong> ${data.opponent}<br>
            <strong>Outcome:</strong> ${data.outcome}<br>
            <em>${data.desc}</em>
        `;
            gsap.to([mapTitle, mapDesc], { opacity: 1, y: 0, duration: 0.2 });
        }
    });

    if (mapImg) {
        gsap.to(mapImg, {
            opacity: 0, duration: 0.2, onComplete: () => {
                mapImg.src = data.img;
                gsap.to(mapImg, { opacity: 0.6, duration: 0.2 });
            }
        });
    }

    document.querySelectorAll('.dot').forEach((dot, idx) => {
        if (idx === currentMap) dot.classList.add('active');
        else dot.classList.remove('active');
    });
}

function goToMap(index) {
    currentMap = index;
    updateMapDisplay();
}

document.getElementById('prev-map').addEventListener('click', () => {
    currentMap = (currentMap - 1 + mapData.length) % mapData.length;
    updateMapDisplay();
});

document.getElementById('next-map').addEventListener('click', () => {
    currentMap = (currentMap + 1) % mapData.length;
    updateMapDisplay();
});

updateMapDisplay();
